<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Web Application Checklist - marulecha Cyber Security">
  <title>marulecha | WebApp Checklist</title>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'>
  <link rel="stylesheet" href="../static/css/theme.css">
  <link rel="icon" href="../static/img/spacelettuceIcon.png" type="image/png">
  <style>
    /* Custom overrides for Checklist page */
    .checklist-container {
      background: #0a0a0a;
      border: 2px solid #00d9ff;
      border-radius: 5px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(0, 217, 255, 0.2);
    }

    .checklist-header {
      border-bottom: 1px solid #00d9ff;
      padding-bottom: 15px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .checklist-title {
      color: #00d9ff;
      font-size: 1.2em;
      margin: 0;
    }

    /* Progress Bar */
    .progress-wrapper {
      width: 100%;
      margin-bottom: 25px;
      background: #001a1f;
      border: 1px solid #005f70;
      padding: 5px;
    }

    .progress-text {
      text-align: right;
      color: #00d9ff;
      font-size: 0.9em;
      margin-bottom: 5px;
    }

    .progress-bar-container {
      height: 20px;
      width: 100%;
      background-color: #000;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: #00d9ff;
      width: 0%;
      box-shadow: 0 0 10px #00d9ff;
      transition: width 0.3s ease;
    }

    /* Split Layout */
    .checklist-interface {
      display: flex;
      gap: 20px;
      min-height: 400px;
    }

    .categories-panel {
      flex: 1;
      border-right: 1px solid #005f70;
      padding-right: 15px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .items-panel {
      flex: 2;
      padding-left: 5px;
    }

    /* Buttons */
    .cat-btn {
      background: rgba(0, 217, 255, 0.05);
      border: 1px solid #005f70;
      color: #00d9ff;
      padding: 10px;
      text-align: left;
      cursor: pointer;
      font-family: 'Share Tech Mono', monospace;
      transition: all 0.2s;
    }

    .cat-btn:hover,
    .cat-btn.active {
      background: #00d9ff;
      color: #000;
      border-color: #00d9ff;
      box-shadow: 0 0 10px rgba(0, 217, 255, 0.4);
    }

    .item-btn {
      display: block;
      width: 100%;
      background: #000;
      border: 1px solid #005f70;
      color: #ccc;
      padding: 10px;
      text-align: left;
      cursor: pointer;
      font-family: 'Share Tech Mono', monospace;
      margin-bottom: 10px;
      transition: all 0.2s;
      position: relative;
    }

    .item-btn:hover {
      border-color: #00d9ff;
    }

    .item-btn.checked {
      background: rgba(0, 217, 255, 0.15);
      border-color: #00d9ff;
      color: #00d9ff;
    }

    .item-btn.checked::after {
      content: '[X]';
      position: absolute;
      right: 10px;
      color: #00d9ff;
    }

    .item-btn::after {
      content: '[ ]';
      position: absolute;
      right: 10px;
      color: #005f70;
    }

    /* Export Button */
    .action-btn {
      background: transparent;
      border: 1px solid #00d9ff;
      color: #00d9ff;
      padding: 8px 15px;
      cursor: pointer;
      font-family: inherit;
      transition: all 0.3s;
    }

    .action-btn:hover {
      background: #00d9ff;
      color: #000;
      box-shadow: 0 0 10px #00d9ff;
    }

    @media (max-width: 768px) {
      .checklist-interface {
        flex-direction: column;
      }

      .categories-panel {
        border-right: none;
        border-bottom: 1px solid #005f70;
        padding-bottom: 15px;
        padding-right: 0;
      }
    }
  </style>
</head>

<body>
  <!-- Scanline Effect -->
  <div class="scanline"></div>

  <!-- Matrix Background Canvas -->
  <canvas id="matrix"></canvas>

  <div class="container">
    <!-- Header -->
    <header>
      <a href="../index.html" class="logo-section">
        <img src="../static/img/spacelettuceIcon.png" alt="Logo" class="logo-img">
        <span class="logo-text glitch">marulecha</span>
      </a>

      <ul class="nav-links">
        <li>
          <a href="https://www.linkedin.com/in/agisilaos-maroulis-a31878b5/" target="_blank">
            <img
              src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2300d9ff'%3E%3Cpath d='M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z'/%3E%3C/svg%3E"
              alt="LinkedIn" class="nav-icon">
          </a>
        </li>
        <li>
          <a href="https://github.com/marulecha" target="_blank">
            <img
              src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2300d9ff'%3E%3Cpath d='M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z'/%3E%3C/svg%3E"
              alt="GitHub" class="nav-icon">
          </a>
        </li>
        <li>
          <a href="https://app.hackthebox.com/profile/1440" target="_blank">
            <img
              src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2300d9ff'%3E%3Cpath d='M12 2L2 7v10l10 5 10-5V7L12 2zm0 2.18l7.46 3.73L12 11.63 4.54 7.91 12 4.18zM4 9.7l7 3.5v6.61l-7-3.5V9.7zm9 10.11v-6.61l7-3.5v6.61l-7 3.5z'/%3E%3C/svg%3E"
              alt="HackTheBox" class="nav-icon">
          </a>
        </li>
      </ul>
    </header>

    <!-- Terminal Section -->
    <section class="terminal">
      <div class="terminal-header">
        <div class="terminal-buttons">
          <div class="terminal-btn"></div>
          <div class="terminal-btn"></div>
          <div class="terminal-btn"></div>
        </div>
        <div class="toggle-container">
          <label class="switch">
            <input type="checkbox" id="toggle-animations-switch">
            <span class="slider round"></span>
          </label>
        </div>
      </div>
      <h1 class="terminal-title">./run_checklist.py<span class="cursor"></span></h1>
      <p class="terminal-subtitle">[+] Methodology | Recon | Exploitation</p>
    </section>

    <!-- Main Content -->
    <div class="content-wrapper">
      <div class="menu-section">
        <h2 class="menu-title">ls -la</h2>
        <ul class="menu-list">
          <li><a href="resume.html">Resume</a></li>
          <li><a href="contact.html">Contact Me</a></li>
          <li><a href="vulndb.html">Vulnerability Database</a></li>
          <li><a href="webChecklist.html"
              style="border-left: 5px solid #00d9ff; padding-left: 25px; background: #001a1f;">Web Application
              Checklist</a></li>
        </ul>
      </div>

      <div class="checklist-container">
        <div class="checklist-header">
          <h2 class="checklist-title">./run_checklist.py</h2>
          <div style="display: flex; gap: 10px;">
            <button class="action-btn" onclick="resetChecklist()">Initialize List</button>
            <button class="action-btn" onclick="generateReport()">Export Report (TXT)</button>
          </div>
        </div>

        <div class="progress-wrapper">
          <div class="progress-text" id="progressText">Progress: 0%</div>
          <div class="progress-bar-container">
            <div class="progress-fill" id="progressBar"></div>
          </div>
        </div>

        <div class="checklist-interface">
          <!-- Categories -->
          <div class="categories-panel" id="categoryList">
            <!-- Categories will be injected here -->
          </div>

          <!-- Items -->
          <div class="items-panel" id="itemsList">
            <p style="color: #005f70;">&lt; Select a category to view items</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="../static/js/settings.js"></script>
  <script src="../static/js/matrix-effect.js"></script>
  <script>
    // Checklist Data
    let checkList = JSON.parse(localStorage.getItem('checkList')) || null;
    let progressBarPercentage = JSON.parse(localStorage.getItem('progressBarPercentage')) || 0;

    // UI Initialization
    async function init() {
      // Migration Check: If we have data but it doesn't look like the new format (e.g. keys start with numbers), clear it.
      if (checkList) {
        const keys = Object.keys(checkList);
        const isNewFormat = keys.some(k => k.match(/^\d+\./));
        if (!isNewFormat) {
          console.log("Old data format detected. Clearing cache.");
          checkList = null;
          localStorage.removeItem('checkList');
          localStorage.removeItem('progressBarPercentage');
          localStorage.removeItem('category');
        }
      }

      if (!checkList) {
        try {
          const response = await fetch('../static/data/webChecklist.json');
          checkList = await response.json();
          localStorage.setItem('checkList', JSON.stringify(checkList));
        } catch (error) {
          console.error("Failed to load checklist data:", error);
          // Fallback 
          checkList = { "Error": [{ "name": "Failed to load data", "state": "unchecked" }] };
        }
      }

      renderCategories();
      updateProgress();

      // Load default or saved category
      const savedCategory = localStorage.getItem('category');
      if (savedCategory && checkList[savedCategory]) {
        loadItems(savedCategory);
        // Highlight active button
        const btn = document.getElementById('cat-' + savedCategory);
        if (btn) btn.classList.add('active');
      }
    }

    function renderCategories() {
      const catContainer = document.getElementById('categoryList');
      catContainer.innerHTML = '';

      for (let category in checkList) {
        const btn = document.createElement('button');
        btn.className = 'cat-btn';
        btn.id = 'cat-' + category;
        btn.innerText = `> ${category}`;
        btn.onclick = () => {
          // Remove active class from all
          document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          localStorage.setItem('category', category);
          loadItems(category);
        };
        catContainer.appendChild(btn);
      }
    }

    function loadItems(category) {
      const itemsContainer = document.getElementById('itemsList');
      itemsContainer.innerHTML = `<h3 style="color:#00d9ff; border-bottom: 1px solid #005f70; padding-bottom:10px; margin-top:0;">${category}</h3>`;

      checkList[category].forEach(item => {
        const btn = document.createElement('button');
        btn.className = `item-btn ${item.state === 'checked' ? 'checked' : ''}`;
        btn.innerText = item.name;
        btn.onclick = () => toggleItem(category, item.name);
        itemsContainer.appendChild(btn);
      });
    }

    function toggleItem(category, itemName) {
      // Update state
      checkList[category].forEach(item => {
        if (item.name === itemName) {
          item.state = item.state === 'checked' ? 'unchecked' : 'checked';
        }
      });

      // Save
      localStorage.setItem('checkList', JSON.stringify(checkList));

      // Re-render items
      loadItems(category);
      updateProgress();
    }

    function updateProgress() {
      let total = 0;
      let checked = 0;

      for (let cat in checkList) {
        checkList[cat].forEach(item => {
          total++;
          if (item.state === 'checked') checked++;
        });
      }

      let percentage = total === 0 ? 0 : (checked / total) * 100;
      percentage = parseFloat(percentage).toFixed(2);

      localStorage.setItem('progressBarPercentage', JSON.stringify(percentage));

      document.getElementById('progressBar').style.width = percentage + '%';
      document.getElementById('progressText').innerText = `Progress: ${percentage}%`;
    }

    // Text Export
    function generateReport() {
      let total = 0;
      let checked = 0;

      // Calculate counts
      let reportContent = "SpaceLettuce Web Application Vulnerability Checklist\n";
      reportContent += "====================================================\n\n";

      let totalItems = 0;
      let checkedItems = 0;

      for (let category in checkList) {
        checkList[category].forEach(item => {
          totalItems++;
          if (item.state === 'checked') {
            checkedItems++;
          }
        });
      }

      reportContent += `Progress: ${checkedItems}/${totalItems} items checked\n\n`;

      for (let category in checkList) {
        reportContent += `[ ${category} ]\n`;
        checkList[category].forEach(item => {
          let status = item.state === 'checked' ? "[x]" : "[ ]";
          reportContent += `${status} ${item.name}\n`;
        });
        reportContent += "\n";
      }

      const blob = new Blob([reportContent], { type: "text/plain" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "SpaceLettuce_Checklist_Report.txt";
      link.click();
    }

    function resetChecklist() {
      if (confirm("Are you sure you want to initialize the list? This will uncheck all items.")) {
        // Clear data from localStorage
        localStorage.removeItem('checkList');
        localStorage.removeItem('progressBarPercentage');

        // Reload the page to fetch fresh data from JSON
        location.reload();
      }
    }

    // Launch
    init();
  </script>
</body>

</html>